# Name: jbx_multiple_image_upload v0.4.0
# Multiple Image Upload
# Author: Jonas Bach
# URL: https://github.com/jbach
# Recommended load order: 5
# .....................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the "Install plugin" box:
# .....................................................................

YToxNDp7czo0OiJuYW1lIjtzOjI1OiJqYnhfbXVsdGlwbGVfaW1hZ2VfdXBsb2FkIjtzOjc6
InZlcnNpb24iO3M6NToiMC40LjAiO3M6NjoiYXV0aG9yIjtzOjEwOiJKb25hcyBCYWNoIjtz
OjEwOiJhdXRob3JfdXJpIjtzOjI0OiJodHRwczovL2dpdGh1Yi5jb20vamJhY2giO3M6MTE6
ImRlc2NyaXB0aW9uIjtzOjIxOiJNdWx0aXBsZSBJbWFnZSBVcGxvYWQiO3M6NDoiaGVscCI7
czowOiIiO3M6NDoiY29kZSI7czo1NTA3OiIKLypERUJVRyovIGdsb2JhbCAkZGVidWc7Ci8q
REVCVUcqLyAkZGVidWcgPSB0cnVlOwovKkRFQlVHKi8gaWYgKCRkZWJ1Zyl7IGluaV9zZXQo
J2Rpc3BsYXlfZXJyb3JzJywgMSk7IGVycm9yX3JlcG9ydGluZyhFX0FMTCk7IH0KLyoqCiAq
IE11bHRpcGxlIEltYWdlIFVwbG9hZCBQbHVnaW4KICogQGF1dGhvciBKb25hcyBCYWNoIDxo
YWxsb0Bqb25hc2JhY2guZGU+CiAqLwpjbGFzcyBqYnhfTUlVewoJLyoqCgkgKiBTdG9yZXMg
YW4gaW5zdGFuY2UKCSAqIEB2YXIgamJ4X01JVQoJICovCglwcm90ZWN0ZWQgc3RhdGljICRp
bnN0YW5jZTsKCgkvKioKCSAqIFNsdWcgb2YgdGhpcyBwbHVnaW4KCSAqIEB2YXIgc3RyaW5n
CgkgKi8KCXByb3RlY3RlZCBzdGF0aWMgJHNsdWcgPSAnamJ4X211bHRpcGxlX2ltYWdlX3Vw
bG9hZCc7CgoJLyoqCgkgKiBQbHVnaW4gcHJlZml4CgkgKiBAdmFyIHN0cmluZwoJICovCglw
cm90ZWN0ZWQgc3RhdGljICRwcmVmaXggPSAnamJ4Xyc7CgoJLyoqCgkgKiBBbGwgYXZhaWxh
YmxlIHByZWZlcmVuY2VzIGZvciB0aGlzIHBsdWdpbgoJICogQHZhciBhcnJheQoJICovCglw
cm90ZWN0ZWQgc3RhdGljICRwcmVmZXJlbmNlcyA9IGFycmF5KAoJCWFycmF5KCdpZCc9Pidm
aWxlc2xpbWl0JywgJ2xhYmVsJz0+J01heC4gRmlsZXMgTGltaXQnLCAnZGVzY3InPT4nVGhl
IG51bWJlciBvZiBmaWxlcyB5b3UgY2FuIGFkZCB0byB0aGUgYmF0Y2guJywgJ3R5cGUnPT4w
LCAnc3RhbmRhcmQnPT4yMCksCgkJYXJyYXkoJ2lkJz0+J3RodW1iJywgJ2xhYmVsJz0+J0Ny
ZWF0ZSB0aHVtYm5haWwnLCAnZGVzY3InPT4nSWYgYSBmaWxlIHRodW1iLWltYWdlbmFtZS5l
eHQgaXMgZm91bmQgdGhlIHRodW1ibmFpbCB3aWxsIHN0aWxsIGJlIGltcG9ydGVkLicsICd0
eXBlJz0+MSwgJ3N0YW5kYXJkJz0+JzEnKSwKCQlhcnJheSgnaWQnPT4ndGh1bWJjcm9wJywg
J2xhYmVsJz0+J0Nyb3AgdGh1bWJuYWlsJywgJ2Rlc2NyJz0+J1RoZSB0aHVtYm5haWwgc2hh
bGwgYmUgY3JvcHBlZC4nLCAndHlwZSc9PjEsICdzdGFuZGFyZCc9PicwJyksCgkJYXJyYXko
J2lkJz0+J3RodW1ieCcsICdsYWJlbCc9PidUaHVtYm5haWwgd2lkdGgnLCAnZGVzY3InPT4n
TWF5IGJlIDAgaWYgdGh1bWJuYWlsIGhlaWdodCBpcyA+MCBhbmQgY3JvcCBkaXNhYmxlZC4n
LCAndHlwZSc9PjAsICdzdGFuZGFyZCc9PjE1MCksCgkJYXJyYXkoJ2lkJz0+J3RodW1ieScs
ICdsYWJlbCc9PidUaHVtYm5haWwgaGVpZ2h0JywgJ2Rlc2NyJz0+J01heSBiZSAwIGlmIHRo
dW1ibmFpbCB3aWR0aCBpcyA+MCBhbmQgY3JvcCBkaXNhYmxlZC4nLCAndHlwZSc9PjAsICdz
dGFuZGFyZCc9PjApLAoJCWFycmF5KCdpZCc9Pid0aHVtYmhpbnQnLCAnbGFiZWwnPT4nVGh1
bWJuYWlsIGljb24nLCAnZGVzY3InPT4nQWRkIGQgc21hbGwgbG9va2luZyBnbGFzcyBpY29u
IHRvIHRodW1ibmFpbC4nLCAndHlwZSc9PjEsICdzdGFuZGFyZCc9PicwJyksCgkJYXJyYXko
J2lkJz0+J3RodW1iZ3JleWhpbnQnLCAnbGFiZWwnPT4nR3JleSBiYXIgYXQgYm90dG9tIG9m
IHRodW1iJywgJ2Rlc2NyJz0+J0dyZXkgYmFyIGF0IGJvdHRvbSBvZiB0aHVtYm5haWwsIHVz
ZSBpdCB3aXRoIGhpbnQuJywgJ3R5cGUnPT4xLCAnc3RhbmRhcmQnPT4nMCcpLAoJCWFycmF5
KCdpZCc9PidyZXNpemUnLCAnbGFiZWwnPT4nUmVzaXplIGltYWdlJywgJ2Rlc2NyJz0+J1Jl
c2l6ZSB0aGUgaW1hZ2UgKHdoYXQgYSBzdXJwcmlzZSkuJywgJ3R5cGUnPT4xLCAnc3RhbmRh
cmQnPT4nMCcpLAoJCWFycmF5KCdpZCc9PidzaGFycGVuJywgJ2xhYmVsJz0+J1NoYXJwZW4g
aW1hZ2UnLCAnZGVzY3InPT4nQ2xhaW1zIHRvIHJlc3VsdCBpbiBiZXR0ZXIgcXVhbGl0eSBy
ZXNpemUuJywgJ3R5cGUnPT4xLCAnc3RhbmRhcmQnPT4nMCcpLAoJCWFycmF5KCdpZCc9Pidp
bWd4JywgJ2xhYmVsJz0+J1Jlc2l6ZSB0byB3aWR0aCcsICdkZXNjcic9PidXaWR0aCB0byBy
ZXNpemUgaW1hZ2UgdG8gKG1heSBiZSAwIGlmIGhlaWdodCA+MCkuJywgJ3R5cGUnPT4wLCAn
c3RhbmRhcmQnPT42NDApLAoJCWFycmF5KCdpZCc9PidpbWd5JywgJ2xhYmVsJz0+J1Jlc2l6
ZSB0byBoZWlnaHQnLCAnZGVzY3InPT4nSGVpZ2h0IHRvIHJlc2l6ZSBpbWFnZSB0byAobWF5
IGJlIDAgaWYgd2lkdGggPjApLicsICd0eXBlJz0+MCwgJ3N0YW5kYXJkJz0+NDgwKSwKCQlh
cnJheSgnaWQnPT4naW1wb3J0aW5mbycsICdsYWJlbCc9PidJbXBvcnQgYWRkaXRpb25hbCBp
bmZvJywgJ2Rlc2NyJz0+J0ltcG9ydCBtZXRhIGluZm8gaW50byBjYXB0aW9uLicsICd0eXBl
Jz0+MiwgJ3N0YW5kYXJkJz0+J25vbmUnKSwKCSk7CgoJLyoqCgkgKiBSZXR1cm5zIGFuIGlu
c3RhbmNlCgkgKiBAcmV0dXJuIGpieF9NSVUgaW5zdGFuY2UKCSAqLwoJc3RhdGljIGZ1bmN0
aW9uIGdldF9pbnN0YW5jZSgpewoJCWlmICggbnVsbCA9PSBzZWxmOjokaW5zdGFuY2UgKSB7
CgkJCXNlbGY6OiRpbnN0YW5jZSA9IG5ldyBqYnhfTUlVKCk7CgkJfQoKCQlyZXR1cm4gc2Vs
Zjo6JGluc3RhbmNlOwoJfQoKCS8qKgoJICogQ29uc3RydWN0b3IKCSAqLwoJcHVibGljIGZ1
bmN0aW9uIF9fY29uc3RydWN0KCl7CgkJYWRkX3ByaXZzKCdwbHVnaW5fcHJlZnMuJy5zZWxm
Ojokc2x1ZywgJzEnKTsKCQlyZWdpc3Rlcl9jYWxsYmFjayhhcnJheSgkdGhpcywgJ3JlbmRl
cl9wcmVmcycpLCAncGx1Z2luX3ByZWZzLicuc2VsZjo6JHNsdWcpOwoJfQoKCS8qKgoJICog
UmVuZGVyIG9wdGlvbnMgcGFnZQoJICogQHBhcmFtICBzdHJpbmcgJGV2ZW50IHRoZSBldmVu
dCBiZWluZyBjYWxsZWQKCSAqIEBwYXJhbSAgc3RyaW5nICRzdGVwICB0aGUgc3RlcCBiZWlu
ZyBjYWxsZWQKCSAqLwoJcHVibGljIGZ1bmN0aW9uIHJlbmRlcl9wcmVmcygkZXZlbnQsICRz
dGVwKXsKCQkkbXNnID0gJyc7CgoJCXBhZ2VUb3AoZ1R4dCgnTXVsdGlwbGUgSW1hZ2UgVXBs
b2FkJyksICRtc2cpOwoJCQoJCS8vIEdlbmVyYXRlIFByZWZlcmVuY2VzIFRhYmxlCgkJJG91
dCA9IGhlZChnVHh0KCdNdWx0aXBsZSBJbWFnZSBVcGxvYWQgLSBQcmVmZXJlbmNlcycpLCAx
KTsKCQkkb3V0IC49IHN0YXJ0VGFibGUoJHRoaXMtPnByZWZpeF9pZCgncHJlZmVyZW5jZXMn
KSwgJ2NlbnRlcicsIDUpOwoJCWZvcmVhY2ggKHNlbGY6OiRwcmVmZXJlbmNlcyBhcyAkcHJl
ZikgewoJCQkkb3V0IC49ICR0aGlzLT5yZW5kZXJfcHJlZigkcHJlZik7CgkJfQoJCQoJCS8v
IHJlbmRlciBzYXZlIGJ1dHRvbgoJCSRvdXQgLj0gdHIodGRjcyhlSW5wdXQoJ3BsdWdpbl9w
cmVmcy4nLnNlbGY6OiRzbHVnKS5zSW5wdXQoJ3VwZGF0ZScpLmZJbnB1dCgnc3VibWl0Jywg
J3NhdmUnLCBnVHh0KCdzYXZlX2J1dHRvbicpLCAncHVibGlzaCcpLCAzLCAnJywgJ25vbGlu
JykpOwoJCQoJCSRvdXQgLj0gZW5kdGFibGUoKTsKCgkJZWNobyBmb3JtKCRvdXQpOwoJfQoK
CS8qKgoJICogUmVuZGVyIHNpbmdsZSBwcmVmZXJlbmNlIHJvdwoJICogQHBhcmFtICBhcnJh
eSAkcHJlZiBwcmVmZXJlbmNlIGFycmF5CgkgKiBAcmV0dXJuIHN0cmluZyAgICAgIDx0cj4g
Y29udGFpbmluZyB0aGUgcHJlZmVyZW5jZQoJICovCglwcml2YXRlIGZ1bmN0aW9uIHJlbmRl
cl9wcmVmKCRwcmVmKXsKCQkvLyByZW5kZXIgbGFiZWwKCQkkb3V0ID0gZkxhYmVsQ2VsbCgk
cHJlZlsnbGFiZWwnXSwgJycsICR0aGlzLT5wcmVmaXhfaWQoJHByZWZbJ2lkJ10pKTsKCgkJ
Ly8gcmVuZGVyIGZpZWxkCgkJJGlkID0gJHRoaXMtPnByZWZpeF9pZCgkcHJlZlsnaWQnXSk7
CgkJJHZhbHVlID0gJHRoaXMtPmdldF9wcmVmKCRwcmVmWydpZCddKTsKCgkJc3dpdGNoKCRw
cmVmWyd0eXBlJ10pewoJCQljYXNlIDI6CgkJCQkkb3V0IC49IHRkKHNlbGVjdElucHV0KCRp
ZCwgYXJyYXkoZ1R4dCgnTm9uZScpID0+ICcnLCAnRVhJRic9PidleGlmJywgJ0lQVEMnPT4n
aXB0YycpLCAkdmFsdWUpKTsKCQkJYnJlYWs7CgoJCQljYXNlIDE6CgkJCQkkb3V0IC49IHRk
KHllc25vUmFkaW8oJGlkLCAkdmFsdWUpKTsKCQkJYnJlYWs7CgoJCQlkZWZhdWx0OgoJCQkJ
JG91dCAuPSBmSW5wdXRDZWxsKCRpZCwgJHZhbHVlLCAnJywgMjAsICcnLCAkaWQpOwoJCQli
cmVhazsKCQl9CgoJCS8vIHJlbmRlciBoZWxwCgkJJG91dCAuPSB0ZCgkcHJlZlsnZGVzY3In
XSk7CgoJCS8vIHJlbmRlciBzYXZlCgkJCgkJcmV0dXJuIHRyKCRvdXQpOwoJfQoKCS8qKgoJ
ICogR2V0IHByZWZpeGVkIHN0cmluZwoJICogQHBhcmFtICBzdHJpbmcgJHZhbHVlIHVucHJl
Zml4ZWQgc3RyaW5nCgkgKiBAcmV0dXJuIHN0cmluZyAgICAgICAgcHJlZml4ZWQgc3RyaW5n
CgkgKi8KCXByaXZhdGUgZnVuY3Rpb24gcHJlZml4KCR2YWx1ZSl7CgkJcmV0dXJuIHNlbGY6
OiRwcmVmaXguJHZhbHVlOwoJfQoKCS8qKgoJICogR2V0IHByZWZpeGVkIEhUTUwgaWQgYXR0
cmlidXRlCgkgKiBAcGFyYW0gIHN0cmluZyAkdmFsdWUgdW5wcmVmaXhlZCBpZAoJICogQHJl
dHVybiBzdHJpbmcgICAgICAgIHByZWZpeGVkIGlkCgkgKi8KCXByaXZhdGUgZnVuY3Rpb24g
cHJlZml4X2lkKCR2YWx1ZSl7CgkJcmV0dXJuIHNlbGY6OiRzbHVnIC4gJ18nIC4gJHZhbHVl
OwoJfQoKCS8qKgoJICogR2V0IHByZWZlcmVuY2UgZnJvbSBEQgoJICogQHBhcmFtICBzdHJp
bmcgJGlkIGZpZWxkIHRvIGdldAoJICogQHJldHVybiBtaXhlZCAgICAgc3RvcmVkIHByZWZl
cmVuY2UKCSAqLwoJcHJpdmF0ZSBmdW5jdGlvbiBnZXRfcHJlZigkaWQpewoJCXJldHVybiBn
ZXRfcHJlZigkdGhpcy0+cHJlZml4KCRpZCkpOwoJfQoKCS8qKgoJICogUmVjdXJzaXZlIGRp
cmVjdG9yeSBkZWxldGUKCSAqIEBwYXJhbSAgc3RyaW5nICRkaXJuYW1lIHBhdGggdG8gZGly
ZWN0b3J5CgkgKiBAcmV0dXJuIFt0eXBlXSAgICAgICAgICBbZGVzY3JpcHRpb25dCgkgKi8K
CXByaXZhdGUgZnVuY3Rpb24gcm1kaXJyKCRkaXJuYW1lKXsKCQkvLyBTYW5pdHkgY2hlY2sK
CQlpZiAoIWZpbGVfZXhpc3RzKCRkaXJuYW1lKSkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoK
CQkvLyBTaW1wbGUgZGVsZXRlIGZvciBhIGZpbGUKCQlpZiAoaXNfZmlsZSgkZGlybmFtZSkg
fHwgaXNfbGluaygkZGlybmFtZSkpIHsKCQkJcmV0dXJuIHVubGluaygkZGlybmFtZSk7CgkJ
fQoKCQkvLyBMb29wIHRocm91Z2ggdGhlIGZvbGRlcgoJCSRkaXIgPSBkaXIoJGRpcm5hbWUp
OwoJCXdoaWxlIChmYWxzZSAhPT0gJGVudHJ5ID0gJGRpci0+cmVhZCgpKSB7CgkJCS8vIFNr
aXAgcG9pbnRlcnMKCQkJaWYgKCRlbnRyeSA9PSAnLicgfHwgJGVudHJ5ID09ICcuLicpIHsK
CQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBSZWN1cnNlCgkJCSR0aGlzLT5ybWRpcnIoJGRp
cm5hbWUgLiBESVJFQ1RPUllfU0VQQVJBVE9SIC4gJGVudHJ5KTsKCQl9CgoJCS8vIENsZWFu
IHVwCgkJJGRpci0+Y2xvc2UoKTsKCQlyZXR1cm4gcm1kaXIoJGRpcm5hbWUpOwoJfQp9Cgov
LyBJbml0aWFsaXplIHBsdWdpbgppZihAdHhwaW50ZXJmYWNlID09PSAnYWRtaW4nKXsKCWpi
eF9NSVU6OmdldF9pbnN0YW5jZSgpOwp9CiI7czo0OiJ0eXBlIjtzOjE6IjMiO3M6NToib3Jk
ZXIiO3M6MToiNSI7czo1OiJmbGFncyI7czoxOiIxIjtzOjg6InRleHRwYWNrIjtzOjA6IiI7
czoxNToiYWxsb3dfaHRtbF9oZWxwIjtpOjA7czo4OiJoZWxwX3JhdyI7czozNTA6ImgxLiBq
YnhfbXVsdGlwbGVfdXBsb2FkCgpBbGxvd3MgeW91IHRvIHVwbG9hZCBtdWx0aXBsZSBpbWFn
ZXMgc2ltdWx0YW5lb3VzbHkuIFNlZSBFeHRlbnNpb25zIHRhYiBmb3IgY29uZmlndXJhdGlv
bi4KClRoaXMgcGx1Z2luIGlzIGEgbW9kaWZpY2F0aW9uIG9mIHRoZSBmcHhfaW1hZ2VfaW1w
b3J0IHBsdWdpbi4KCmgyLiBVc2FnZQoKSnVzdCBhY3RpdmF0ZSEKCmgyLiBDcmVkaXRzCgoq
ICJEaXJrIFN0ZWlucyI6aHR0cDovL2RpcmtzdGVpbnMuZGUvIGZvciBmcHhfaW1hZ2VfaW1w
b3J0CiogIkpvbi1NaWNoYWVsIERlbGRpbiI6aHR0cDovL2ptZGVsZGluLmNvbS8gZm9yIGlu
c3BpcmF0aW9uIC8gZnVuY3Rpb25zIjtzOjM6Im1kNSI7czozMjoiNjYyYjdhM2NhYjhhZDAw
MGUzODAxZGNjM2M4MGEwNTIiO30=
