# Name: jbx_multiple_image_upload v0.4.0
# Multiple Image Upload
# Author: Jonas Bach
# URL: https://github.com/jbach
# Recommended load order: 5
# .....................................................................
# This is a plugin for Textpattern - http://textpattern.com/
# To install: textpattern > admin > plugins
# Paste the following text into the "Install plugin" box:
# .....................................................................

YToxNDp7czo0OiJuYW1lIjtzOjI1OiJqYnhfbXVsdGlwbGVfaW1hZ2VfdXBsb2FkIjtzOjc6
InZlcnNpb24iO3M6NToiMC40LjAiO3M6NjoiYXV0aG9yIjtzOjEwOiJKb25hcyBCYWNoIjtz
OjEwOiJhdXRob3JfdXJpIjtzOjI0OiJodHRwczovL2dpdGh1Yi5jb20vamJhY2giO3M6MTE6
ImRlc2NyaXB0aW9uIjtzOjIxOiJNdWx0aXBsZSBJbWFnZSBVcGxvYWQiO3M6NDoiaGVscCI7
czowOiIiO3M6NDoiY29kZSI7czo2MTMwOiIKLypERUJVRyovIGdsb2JhbCAkZGVidWc7Ci8q
REVCVUcqLyAkZGVidWcgPSB0cnVlOwovKkRFQlVHKi8gaWYgKCRkZWJ1Zyl7IGluaV9zZXQo
J2Rpc3BsYXlfZXJyb3JzJywgMSk7IGVycm9yX3JlcG9ydGluZyhFX0FMTCk7IH0KLyoqCiAq
IE11bHRpcGxlIEltYWdlIFVwbG9hZCBQbHVnaW4KICogQGF1dGhvciBKb25hcyBCYWNoIDxo
YWxsb0Bqb25hc2JhY2guZGU+CiAqLwpjbGFzcyBqYnhfTUlVewoJLyoqCgkgKiBTdG9yZXMg
YW4gaW5zdGFuY2UKCSAqIEB2YXIgamJ4X01JVQoJICovCglwcm90ZWN0ZWQgc3RhdGljICRp
bnN0YW5jZTsKCgkvKioKCSAqIFNsdWcgb2YgdGhpcyBwbHVnaW4KCSAqIEB2YXIgc3RyaW5n
CgkgKi8KCXByb3RlY3RlZCBzdGF0aWMgJHNsdWcgPSAnamJ4X211bHRpcGxlX2ltYWdlX3Vw
bG9hZCc7CgoJLyoqCgkgKiBQbHVnaW4gcHJlZml4CgkgKiBAdmFyIHN0cmluZwoJICovCglw
cm90ZWN0ZWQgc3RhdGljICRwcmVmaXggPSAnamJ4Xyc7CgoJLyoqCgkgKiBBbGwgYXZhaWxh
YmxlIHByZWZlcmVuY2VzIGZvciB0aGlzIHBsdWdpbgoJICogQHZhciBhcnJheQoJICovCglw
cm90ZWN0ZWQgc3RhdGljICRwcmVmZXJlbmNlcyA9IGFycmF5KAoJCSdmaWxlc2xpbWl0JyA9
PiBhcnJheSgnbGFiZWwnPT4nTWF4LiBGaWxlcyBMaW1pdCcsICdkZXNjcic9PidUaGUgbnVt
YmVyIG9mIGZpbGVzIHlvdSBjYW4gYWRkIHRvIHRoZSBiYXRjaC4nLCAndHlwZSc9PjAsICdk
ZWZhdWx0Jz0+MjApLAoJCSd0aHVtYicgPT5hcnJheSgnbGFiZWwnPT4nQ3JlYXRlIHRodW1i
bmFpbCcsICdkZXNjcic9PidJZiBhIGZpbGUgdGh1bWItaW1hZ2VuYW1lLmV4dCBpcyBmb3Vu
ZCB0aGUgdGh1bWJuYWlsIHdpbGwgc3RpbGwgYmUgaW1wb3J0ZWQuJywgJ3R5cGUnPT4xLCAn
ZGVmYXVsdCc9PicxJyksCgkJJ3RodW1iY3JvcCcgPT4gYXJyYXkoJ2xhYmVsJz0+J0Nyb3Ag
dGh1bWJuYWlsJywgJ2Rlc2NyJz0+J1RoZSB0aHVtYm5haWwgc2hhbGwgYmUgY3JvcHBlZC4n
LCAndHlwZSc9PjEsICdkZWZhdWx0Jz0+JzAnKSwKCQkndGh1bWJ4JyA9PiBhcnJheSgnbGFi
ZWwnPT4nVGh1bWJuYWlsIHdpZHRoJywgJ2Rlc2NyJz0+J01heSBiZSAwIGlmIHRodW1ibmFp
bCBoZWlnaHQgaXMgPjAgYW5kIGNyb3AgZGlzYWJsZWQuJywgJ3R5cGUnPT4wLCAnZGVmYXVs
dCc9PjE1MCksCgkJJ3RodW1ieSc9PiBhcnJheSgnbGFiZWwnPT4nVGh1bWJuYWlsIGhlaWdo
dCcsICdkZXNjcic9PidNYXkgYmUgMCBpZiB0aHVtYm5haWwgd2lkdGggaXMgPjAgYW5kIGNy
b3AgZGlzYWJsZWQuJywgJ3R5cGUnPT4wLCAnZGVmYXVsdCc9PjApLAoJCSd0aHVtYmhpbnQn
PT4gYXJyYXkoJ2xhYmVsJz0+J1RodW1ibmFpbCBpY29uJywgJ2Rlc2NyJz0+J0FkZCBkIHNt
YWxsIGxvb2tpbmcgZ2xhc3MgaWNvbiB0byB0aHVtYm5haWwuJywgJ3R5cGUnPT4xLCAnZGVm
YXVsdCc9PicwJyksCgkJJ3RodW1iZ3JleWhpbnQnPT4gYXJyYXkoJ2xhYmVsJz0+J0dyZXkg
YmFyIGF0IGJvdHRvbSBvZiB0aHVtYicsICdkZXNjcic9PidHcmV5IGJhciBhdCBib3R0b20g
b2YgdGh1bWJuYWlsLCB1c2UgaXQgd2l0aCBoaW50LicsICd0eXBlJz0+MSwgJ2RlZmF1bHQn
PT4nMCcpLAoJCSdyZXNpemUnPT4gYXJyYXkoJ2xhYmVsJz0+J1Jlc2l6ZSBpbWFnZScsICdk
ZXNjcic9PidSZXNpemUgdGhlIGltYWdlICh3aGF0IGEgc3VycHJpc2UpLicsICd0eXBlJz0+
MSwgJ2RlZmF1bHQnPT4nMCcpLAoJCSdzaGFycGVuJz0+IGFycmF5KCdsYWJlbCc9PidTaGFy
cGVuIGltYWdlJywgJ2Rlc2NyJz0+J0NsYWltcyB0byByZXN1bHQgaW4gYmV0dGVyIHF1YWxp
dHkgcmVzaXplLicsICd0eXBlJz0+MSwgJ2RlZmF1bHQnPT4nMCcpLAoJCSdpbWd4Jz0+IGFy
cmF5KCdsYWJlbCc9PidSZXNpemUgdG8gd2lkdGgnLCAnZGVzY3InPT4nV2lkdGggdG8gcmVz
aXplIGltYWdlIHRvIChtYXkgYmUgMCBpZiBoZWlnaHQgPjApLicsICd0eXBlJz0+MCwgJ2Rl
ZmF1bHQnPT42NDApLAoJCSdpbWd5Jz0+IGFycmF5KCdsYWJlbCc9PidSZXNpemUgdG8gaGVp
Z2h0JywgJ2Rlc2NyJz0+J0hlaWdodCB0byByZXNpemUgaW1hZ2UgdG8gKG1heSBiZSAwIGlm
IHdpZHRoID4wKS4nLCAndHlwZSc9PjAsICdkZWZhdWx0Jz0+NDgwKSwKCQknaW1wb3J0aW5m
byc9PiBhcnJheSgnbGFiZWwnPT4nSW1wb3J0IGFkZGl0aW9uYWwgaW5mbycsICdkZXNjcic9
PidJbXBvcnQgbWV0YSBpbmZvIGludG8gY2FwdGlvbi4nLCAndHlwZSc9PjIsICdkZWZhdWx0
Jz0+J25vbmUnKSwKCSk7CgoJLyoqCgkgKiBSZXR1cm5zIGFuIGluc3RhbmNlCgkgKiBAcmV0
dXJuIGpieF9NSVUgaW5zdGFuY2UKCSAqLwoJc3RhdGljIGZ1bmN0aW9uIGdldF9pbnN0YW5j
ZSgpewoJCWlmICggbnVsbCA9PSBzZWxmOjokaW5zdGFuY2UgKSB7CgkJCXNlbGY6OiRpbnN0
YW5jZSA9IG5ldyBqYnhfTUlVKCk7CgkJfQoKCQlyZXR1cm4gc2VsZjo6JGluc3RhbmNlOwoJ
fQoKCS8qKgoJICogQ29uc3RydWN0b3IKCSAqLwoJcHVibGljIGZ1bmN0aW9uIF9fY29uc3Ry
dWN0KCl7CgkJYWRkX3ByaXZzKCdwbHVnaW5fcHJlZnMuJy5zZWxmOjokc2x1ZywgJzEnKTsK
CQlyZWdpc3Rlcl9jYWxsYmFjayhhcnJheSgkdGhpcywgJ3JlbmRlcl9wcmVmcycpLCAncGx1
Z2luX3ByZWZzLicuc2VsZjo6JHNsdWcpOwoJfQoKCS8qKgoJICogUmVuZGVyIG9wdGlvbnMg
cGFnZQoJICogQHBhcmFtICBzdHJpbmcgJGV2ZW50IHRoZSBldmVudCBiZWluZyBjYWxsZWQK
CSAqIEBwYXJhbSAgc3RyaW5nICRzdGVwICB0aGUgc3RlcCBiZWluZyBjYWxsZWQKCSAqLwoJ
cHVibGljIGZ1bmN0aW9uIHJlbmRlcl9wcmVmcygkZXZlbnQsICRzdGVwKXsKCQlpZigkc3Rl
cCA9PT0gJ3VwZGF0ZScpewoJCQkkdGhpcy0+dXBkYXRlX3ByZWZzKCk7CgkJfQoKCQlwYWdl
VG9wKGdUeHQoJ011bHRpcGxlIEltYWdlIFVwbG9hZCcpKTsKCQkKCQkvLyBHZW5lcmF0ZSBQ
cmVmZXJlbmNlcyBUYWJsZQoJCSRvdXQgPSBoZWQoZ1R4dCgnTXVsdGlwbGUgSW1hZ2UgVXBs
b2FkIC0gUHJlZmVyZW5jZXMnKSwgMSk7CgkJJG91dCAuPSBzdGFydFRhYmxlKCR0aGlzLT5w
cmVmaXhfaWQoJ3ByZWZlcmVuY2VzJyksICdjZW50ZXInLCA1KTsKCQlmb3JlYWNoIChzZWxm
OjokcHJlZmVyZW5jZXMgYXMgJGtleSA9PiAkcHJlZikgewoJCQkkb3V0IC49ICR0aGlzLT5y
ZW5kZXJfcHJlZigka2V5LCAkcHJlZik7CgkJfQoJCQoJCS8vIHJlbmRlciBzYXZlIGJ1dHRv
bgoJCSRvdXQgLj0gdHIodGRjcyhlSW5wdXQoJ3BsdWdpbl9wcmVmcy4nLnNlbGY6OiRzbHVn
KS5zSW5wdXQoJ3VwZGF0ZScpLmZJbnB1dCgnc3VibWl0JywgJ3NhdmUnLCBnVHh0KCdzYXZl
X2J1dHRvbicpLCAncHVibGlzaCcpLCAzLCAnJywgJ25vbGluJykpOwoJCQoJCSRvdXQgLj0g
ZW5kdGFibGUoKTsKCgkJZWNobyBmb3JtKCRvdXQpOwoJfQoKCS8qKgoJICogUmVuZGVyIHNp
bmdsZSBwcmVmZXJlbmNlIHJvdwoJICogQHBhcmFtICBhcnJheSAkcHJlZiBwcmVmZXJlbmNl
IGFycmF5CgkgKiBAcmV0dXJuIHN0cmluZyAgICAgIDx0cj4gY29udGFpbmluZyB0aGUgcHJl
ZmVyZW5jZQoJICovCglwcml2YXRlIGZ1bmN0aW9uIHJlbmRlcl9wcmVmKCRpZCwgJHByZWYp
ewoJCSR2YWx1ZSA9ICR0aGlzLT5nZXRfcHJlZigkaWQpOwoJCSRpZCA9ICR0aGlzLT5wcmVm
aXhfaWQoJGlkKTsKCgkJLy8gcmVuZGVyIGxhYmVsCgkJJG91dCA9IGZMYWJlbENlbGwoZ1R4
dCgkcHJlZlsnbGFiZWwnXSksICcnLCAkaWQpOwoKCQkvLyByZW5kZXIgZmllbGQKCQlzd2l0
Y2goJHByZWZbJ3R5cGUnXSl7CgkJCWNhc2UgMjoKCQkJCSRvdXQgLj0gdGQoc2VsZWN0SW5w
dXQoJGlkLCBhcnJheShnVHh0KCdOb25lJykgPT4gJycsICdFWElGJz0+J2V4aWYnLCAnSVBU
Qyc9PidpcHRjJyksICR2YWx1ZSkpOwoJCQlicmVhazsKCgkJCWNhc2UgMToKCQkJCSRvdXQg
Lj0gdGQoeWVzbm9SYWRpbygkaWQsICR2YWx1ZSkpOwoJCQlicmVhazsKCgkJCWRlZmF1bHQ6
CgkJCQkkb3V0IC49IGZJbnB1dENlbGwoJGlkLCAkdmFsdWUsICcnLCAyMCwgJycsICRpZCk7
CgkJCWJyZWFrOwoJCX0KCgkJLy8gcmVuZGVyIGhlbHAKCQkkb3V0IC49IHRkKGdUeHQoJHBy
ZWZbJ2Rlc2NyJ10pKTsKCgkJLy8gcmVuZGVyIHNhdmUKCQkKCQlyZXR1cm4gdHIoJG91dCk7
Cgl9CgoJLyoqCgkgKiBVcGRhdGUgcHJlZmVyZW5jZXMgZnJvbSBzdWJtaXR0ZWQgZm9ybQoJ
ICovCglwcml2YXRlIGZ1bmN0aW9uIHVwZGF0ZV9wcmVmcygpewoJCWZvcmVhY2ggKHNlbGY6
OiRwcmVmZXJlbmNlcyBhcyAka2V5ID0+ICRwcmVmKSB7CgkJCSR0aGlzLT5zZXRfcHJlZigk
a2V5LCBncHMoJHRoaXMtPnByZWZpeF9pZCgka2V5KSkpOwoJCX0KCQl0eHBfZGllKCcnLCAn
MzAyJywgJz9ldmVudD1wbHVnaW5fcHJlZnMuamJ4X211bHRpcGxlX2ltYWdlX3VwbG9hZCcp
OwoJfQoKCS8qKgoJICogR2V0IHByZWZpeGVkIHN0cmluZwoJICogQHBhcmFtICBzdHJpbmcg
JHZhbHVlIHVucHJlZml4ZWQgc3RyaW5nCgkgKiBAcmV0dXJuIHN0cmluZyAgICAgICAgcHJl
Zml4ZWQgc3RyaW5nCgkgKi8KCXByaXZhdGUgZnVuY3Rpb24gcHJlZml4KCR2YWx1ZSl7CgkJ
cmV0dXJuIHNlbGY6OiRwcmVmaXguJHZhbHVlOwoJfQoKCS8qKgoJICogR2V0IHByZWZpeGVk
IEhUTUwgaWQgYXR0cmlidXRlCgkgKiBAcGFyYW0gIHN0cmluZyAkdmFsdWUgdW5wcmVmaXhl
ZCBpZAoJICogQHJldHVybiBzdHJpbmcgICAgICAgIHByZWZpeGVkIGlkCgkgKi8KCXByaXZh
dGUgZnVuY3Rpb24gcHJlZml4X2lkKCR2YWx1ZSl7CgkJcmV0dXJuIHNlbGY6OiRzbHVnIC4g
J18nIC4gJHZhbHVlOwoJfQoKCS8qKgoJICogR2V0IHByZWZlcmVuY2UgZnJvbSBEQgoJICog
QHBhcmFtICBzdHJpbmcgJGlkIGZpZWxkIHRvIGdldAoJICogQHJldHVybiBtaXhlZCAgICAg
IHN0b3JlZCBwcmVmZXJlbmNlCgkgKi8KCXByaXZhdGUgZnVuY3Rpb24gZ2V0X3ByZWYoJGlk
KXsKCQlyZXR1cm4gZ2V0X3ByZWYoJHRoaXMtPnByZWZpeCgkaWQpLCBzZWxmOjokcHJlZmVy
ZW5jZXNbJGlkXVsnZGVmYXVsdCddKTsKCX0KCgkvKioKCSAqIFNldCBwcmVmZXJlbmNlICh1
cGRhdGUvaW5zZXJ0KQoJICogQHBhcmFtIHN0cmluZyAkaWQgIHVucHJlZml4ZWQga2V5IG9m
IHByZWZlcmVuY2UKCSAqIEBwYXJhbSBzdHJpbmcgJHZhbCB2YWx1ZSB0byBzYXZlCgkgKi8K
CXByaXZhdGUgZnVuY3Rpb24gc2V0X3ByZWYoJGlkLCAkdmFsID0gJycsICRkZWZhdWx0ID0g
JycpewoJCSRkZWZhdWx0ID0gKCRkZWZhdWx0ID09PSAnJyk/IHNlbGY6OiRwcmVmZXJlbmNl
c1skaWRdWydkZWZhdWx0J10gOiAkZGVmYXVsdDsKCQkkdmFsID0gdHJpbSgkdmFsKTsKCQkk
dmFsID0gKCR2YWwgPT09ICcnKSA/ICRkZWZhdWx0IDogJHZhbDsKCQlyZXR1cm4gc2V0X3By
ZWYoJHRoaXMtPnByZWZpeCgkaWQpLCAkdmFsLCBzZWxmOjokc2x1ZywgMik7Cgl9CgoJLyoq
CgkgKiBSZWN1cnNpdmUgZGlyZWN0b3J5IGRlbGV0ZQoJICogQHBhcmFtICBzdHJpbmcgJGRp
cm5hbWUgcGF0aCB0byBkaXJlY3RvcnkKCSAqLwoJcHJpdmF0ZSBmdW5jdGlvbiBybWRpcnIo
JGRpcm5hbWUpewoJCS8vIFNhbml0eSBjaGVjawoJCWlmICghZmlsZV9leGlzdHMoJGRpcm5h
bWUpKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCS8vIFNpbXBsZSBkZWxldGUgZm9yIGEg
ZmlsZQoJCWlmIChpc19maWxlKCRkaXJuYW1lKSB8fCBpc19saW5rKCRkaXJuYW1lKSkgewoJ
CQlyZXR1cm4gdW5saW5rKCRkaXJuYW1lKTsKCQl9CgoJCS8vIExvb3AgdGhyb3VnaCB0aGUg
Zm9sZGVyCgkJJGRpciA9IGRpcigkZGlybmFtZSk7CgkJd2hpbGUgKGZhbHNlICE9PSAkZW50
cnkgPSAkZGlyLT5yZWFkKCkpIHsKCQkJLy8gU2tpcCBwb2ludGVycwoJCQlpZiAoJGVudHJ5
ID09ICcuJyB8fCAkZW50cnkgPT0gJy4uJykgewoJCQkJY29udGludWU7CgkJCX0KCgkJCS8v
IFJlY3Vyc2UKCQkJJHRoaXMtPnJtZGlycigkZGlybmFtZSAuIERJUkVDVE9SWV9TRVBBUkFU
T1IgLiAkZW50cnkpOwoJCX0KCgkJLy8gQ2xlYW4gdXAKCQkkZGlyLT5jbG9zZSgpOwoJCXJl
dHVybiBybWRpcigkZGlybmFtZSk7Cgl9Cn0KCi8vIEluaXRpYWxpemUgcGx1Z2luCmlmKEB0
eHBpbnRlcmZhY2UgPT09ICdhZG1pbicpewoJamJ4X01JVTo6Z2V0X2luc3RhbmNlKCk7Cn0K
IjtzOjQ6InR5cGUiO3M6MToiMyI7czo1OiJvcmRlciI7czoxOiI1IjtzOjU6ImZsYWdzIjtz
OjE6IjEiO3M6ODoidGV4dHBhY2siO3M6MDoiIjtzOjE1OiJhbGxvd19odG1sX2hlbHAiO2k6
MDtzOjg6ImhlbHBfcmF3IjtzOjM1MDoiaDEuIGpieF9tdWx0aXBsZV91cGxvYWQKCkFsbG93
cyB5b3UgdG8gdXBsb2FkIG11bHRpcGxlIGltYWdlcyBzaW11bHRhbmVvdXNseS4gU2VlIEV4
dGVuc2lvbnMgdGFiIGZvciBjb25maWd1cmF0aW9uLgoKVGhpcyBwbHVnaW4gaXMgYSBtb2Rp
ZmljYXRpb24gb2YgdGhlIGZweF9pbWFnZV9pbXBvcnQgcGx1Z2luLgoKaDIuIFVzYWdlCgpK
dXN0IGFjdGl2YXRlIQoKaDIuIENyZWRpdHMKCiogIkRpcmsgU3RlaW5zIjpodHRwOi8vZGly
a3N0ZWlucy5kZS8gZm9yIGZweF9pbWFnZV9pbXBvcnQKKiAiSm9uLU1pY2hhZWwgRGVsZGlu
IjpodHRwOi8vam1kZWxkaW4uY29tLyBmb3IgaW5zcGlyYXRpb24gLyBmdW5jdGlvbnMiO3M6
MzoibWQ1IjtzOjMyOiI5YWU4ZjgzYzFjOTQwNWFlZjI5YThmNjE5OTU5NTY1OSI7fQ==
